#!/bin/sh
NAME="openerp-manage"
APP_PATH="/var/www/<%=openerp_project%>/private/openerp-manage"
DAEMON="/usr/bin/paster"
RUN_MODE="production.ini"
DAEMON_OPTS="serve --reload --log-file /var/www/<%=openerp_project%>/private/paster-logs/paster.log --server-name=main $RUN_MODE"
RUN_AS="www-data"
PID_FILE="/var/run/paster.pid"

test -x $DAEMON || exit 0
set -e
case "$1" in
  start)
        echo -n "Starting $NAME: "
        start-stop-daemon -d $APP_PATH -c $RUN_AS --start --background --pidfile $PID_FILE  --make-pidfile --exec $DAEMON -- $DAEMON_OPTS
        echo "done."
        ;;
  stop)
        echo -n "Stopping $NAME: "
        start-stop-daemon --stop --pidfile $PID_FILE
        echo "done."
        ;;
  restart|force-reload)
        echo -n "Restarting $NAME: "
        start-stop-daemon --stop --pidfile $PID_FILE
        sleep 1
        start-stop-daemon -d $APP_PATH -c $RUN_AS --start --background --pidfile $PID_FILE  --make-pidfile --exec $DAEMON -- $DAEMON_OPTS
        echo "done."
        ;;
  *)
        echo "Usage: $0 {start|stop|restart|force-reload}" >&2
        exit 1
        ;;
esac
exit 0
